<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>123</title>
    <url>/2024/08/21/123/</url>
    <content><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="Oh, these decrypted content cannot be verified, but you can still have a look.">
  <script id="hbeData" type="hbeData" data-hmacdigest="33a6a72fc290513fea553c0f52fc7b20ba10d9d3bc5e05f5e46a8b058277ab5a">4630436162ade97ba2718b7d0c4b3b63fe08207cb62f17de1c1df0858f7d75759c08cb94437e9d69d05dfcb58d1cf4cf</script>
  <div class="hbe hbe-content">
    <div class="hbe hbe-input hbe-input-default">
      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">
      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">
        <span class="hbe hbe-input-label-content hbe-input-label-content-default">Hey, password is required here.</span>
      </label>
    </div>
  </div>
</div>
<script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
      <tags>
        <tag>encryptAsDiary</tag>
      </tags>
  </entry>
  <entry>
    <title>华三交换机同步ntp</title>
    <url>/2024/08/22/20240821-%E5%8D%8E%E4%B8%89%E4%BA%A4%E6%8D%A2%E6%9C%BA%E5%90%8C%E6%AD%A5ntp/</url>
    <content><![CDATA[<p>华三核心交换机配置为ntp服务器</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[Switch]ntp-service enable</span><br><span class="line">[Switch]ntp-service refclock-master 2</span><br></pre></td></tr></table></figure>

<p>其他的汇聚交换机和楼层交换机从核心交换机同步时间</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[Switch]ntp-service enable</span><br><span class="line">[Switch]ntp-service unicast-server 1.0.1.11</span><br><span class="line">[Switch]display ntp status</span><br></pre></td></tr></table></figure>

<p>显示已经同步成功了，但是时间显示还是不对，查文档汇聚交换机和楼层交换机上还需要配置</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[Switch] undo clock pro</span><br><span class="line">[Switch] clock timezone beijing add 8</span><br></pre></td></tr></table></figure>

]]></content>
  </entry>
  <entry>
    <title>交换机hybrid接口配置</title>
    <url>/2024/08/23/20240823-20240823/</url>
    <content><![CDATA[<h1 id="配置基于IP子网划分VLAN示例"><a href="#配置基于IP子网划分VLAN示例" class="headerlink" title="配置基于IP子网划分VLAN示例"></a>配置基于IP子网划分VLAN示例</h1><p>基于IP子网划分VLAN的原理是网络管理者预先配置IP地址和VLAN ID映射关系表，根据数据帧中的源IP地址和子网掩码来划分VLAN，比如把VLAN10 和10.10.10.0&#x2F;24网段做了映射，那么当交换机收到的是源ip是10.10.10.0&#x2F;24网段的地址数据，就依据映射关系将数据帧添加指定VLAN10的标签。然后数据帧将在指定VLAN10中传输。</p>
<p>使用基于子网的 VLAN 划分方式即可将源自不同子网主机的上行流量送入对应 VLAN，并将来自受允许的 VLAN 的流量根据 MAC 表 untag 发送到对应的边缘端口，实现对主机和傻瓜交换机透明的（也就是不带 tag 的）一端口多 VLAN。</p>
<p>客户需求：<br>    智能交换机不够了，只有傻瓜交换机，而且傻瓜交换机下连接不同VLAN的业务，需要傻瓜交换机下接的不同业务的设备网络能通，或者电脑能通不同业务的网络，方便运维。<br>拓扑图：</p>
<p><img src="/./images/20240823/1724379466071.jpg" alt="1724379466071"></p>
<h1 id="华为交换机配置"><a href="#华为交换机配置" class="headerlink" title="华为交换机配置"></a>华为交换机配置</h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[LSW1]interface Gi0/0/2</span><br><span class="line">[LSW1]port link-type trunk //交换机之间使用trunk类型透传需要的VLAN</span><br><span class="line">[LSW1]port trunk allow-pass vlan all</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[LSW4]interface Gi0/0/2</span><br><span class="line">[LSW4]port link-type trunk //交换机之间使用trunk类型透传需要的VLAN</span><br><span class="line">[LSW4]port trunk allow-pass vlan all</span><br><span class="line">[LSW4]vlan batch 114 116</span><br><span class="line">[LSW4-vlan 116]ip-subnet-vlan 1 ip 192.168.116.0 255.255.255.0 //IP地址为192.168.116.0/24，在VLAN 1160域内转发</span><br><span class="line">[LSW4-vlan 120]ip-subnet-vlan 1 ip 192.168.120.0 255.255.255.0 //IP地址为192.168.120.0/24，在VLAN 120域内转发</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[LSW4]interface GigabitEthernet0/0/1</span><br><span class="line">[LSW4]port link-type hybrid //基于IP子网划分VLAN只能应用在类型为hybrid的接口</span><br><span class="line">[LSW4]undo port hybrid vlan 1</span><br><span class="line">[LSW4]port hybrid untagged vlan 116 120 //对VLAN为100、200、300的报文，剥掉VLAN Tag</span><br><span class="line">[LSW4]ip-subnet-vlan enable //使能接口的IP-VLAN功能</span><br></pre></td></tr></table></figure>

<p>下连电脑不通试着配置</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[LSW4]port hybrid pvid vlan 116</span><br></pre></td></tr></table></figure>

<p><img src="/./images/20240823/1724380480187.jpg" alt="1724380480187"></p>
<h1 id="华三交换机配置"><a href="#华三交换机配置" class="headerlink" title="华三交换机配置"></a>华三交换机配置</h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[LSW4]interface Gi0/0/2</span><br><span class="line">[LSW4]port link-type trunk //交换机之间使用trunk类型透传需要的VLAN</span><br><span class="line">[LSW4]port trunk allow-pass vlan all</span><br><span class="line">[LSW4]vlan batch 114 116</span><br><span class="line">[LSW4-vlan 116]ip-subnet-vlan 1 ip 192.168.116.0 255.255.255.0 //IP地址为192.168.116.0/24，在VLAN 1160域内转发</span><br><span class="line">[LSW4-vlan 120]ip-subnet-vlan 1 ip 192.168.120.0 255.255.255.0 //IP地址为192.168.120.0/24，在VLAN 120域内转发</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[LSW4]interface GigabitEthernet0/0/1</span><br><span class="line">[LSW4]port link-type hybrid //基于IP子网划分VLAN只能应用在类型为hybrid的接口</span><br><span class="line">[LSW4]undo port hybrid vlan 1</span><br><span class="line">[LSW4]port hybrid 116 120 untagged//对VLAN为100、200、300的报文，剥掉VLAN Tag</span><br><span class="line">[LSW4]ip-subnet-vlan enable //使能接口的IP-VLAN功能</span><br><span class="line">[LSW4]port hybrid ip-subnet-vlan vlan 116</span><br><span class="line">[LSW4]port hybrid ip-subnet-vlan vlan 120</span><br></pre></td></tr></table></figure>

]]></content>
  </entry>
  <entry>
    <title>burp使用captcha-killer-modified插件</title>
    <url>/2024/08/22/20240822-20240822/</url>
    <content><![CDATA[<h1 id="github下载captcha-killer-modified插件"><a href="#github下载captcha-killer-modified插件" class="headerlink" title="github下载captcha-killer-modified插件"></a>github下载captcha-killer-modified插件</h1><hr>
<p>git clone <a href="https://github.com/f0ng/captcha-killer-modified">https://github.com/f0ng/captcha-killer-modified</a><br>burp添加安装插件,点击Extensions模块，在Extension details一栏点击Add，选择刚下好的jar包。并点击下一步完成安装。<br><img src="/./images/20240822/11.jpg" alt="11"></p>
<hr>
<h1 id="安装ddddocr和aiohttp服务"><a href="#安装ddddocr和aiohttp服务" class="headerlink" title="安装ddddocr和aiohttp服务"></a>安装ddddocr和aiohttp服务</h1><hr>
<p>pip install -i <a href="http://mirrors.aliyun.com/pypi/simple/">http://mirrors.aliyun.com/pypi/simple/</a> –trusted host mirrors.aliyun.com ddddocr aiohttp<br>安装完成后执行codereg.py，先修改codereg.py，把文件里端口号”8888”的双引号去掉<br><img src="/./images/20240822/10.png" alt="10"><br>    cmd窗口执行python coderg.py 出现以下内容即代表验证码识别服务已搭建完成。<br><img src="/./images/20240822/1.png" alt="1"></p>
<h1 id="靶场演示"><a href="#靶场演示" class="headerlink" title="靶场演示"></a>靶场演示</h1><hr>
<p>burp抓报，获取目标验证码接口，鼠标右键发送至intruder和captcha-killer-modified插件<br><img src="/./images/20240822/12.png" alt="12"></p>
<p>点击获取按钮，获取验证码，在接口url填写127.0.0.1:8888，在request template下右键选择”模板库”，选择dddddocr，可以看到返回了验证码。<br><img src="/./images/20240822/13.jpg" alt="13"><img src="/./images/20240822/4-1725327633950-2.png" alt="4"></p>
<h1 id="爆破登录页面验证码识别相关配置"><a href="#爆破登录页面验证码识别相关配置" class="headerlink" title="爆破登录页面验证码识别相关配置"></a>爆破登录页面验证码识别相关配置</h1><hr>
<p>转到intruder模块Attack type选择”Pitchfork”，在username、password和verifyCode处设置变量<br><img src="/./images/20240822/5.png" alt="5">在Payloads栏下的第3个变量选择Extension-generated，点击Select generator选择”captcha-killer-modified”<br><img src="/./images/20240822/3.png" alt="3"></p>
<p>在Resource Pool栏下设置发送请求间隔，防止验证码获取错误。<br><img src="/./images/20240822/7.png" alt="7"><br>点击Start attack，看效果，查看返回码Length不同的Response为爆破成功。<br><img src="/./images/20240822/9.png" alt="9"></p>
]]></content>
  </entry>
  <entry>
    <title>交换机ssh配置和密码策略</title>
    <url>/2024/10/30/20241030-20241030/</url>
    <content><![CDATA[<h1 id="华为交换机配置"><a href="#华为交换机配置" class="headerlink" title="华为交换机配置"></a>华为交换机配置</h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[Huawei]set password min-length 8  //设置密码最小长度为8</span><br><span class="line">[Huawei]stelnet server enable      //开启ssh服务</span><br><span class="line">[Huawei]ssh client first-time enable  </span><br><span class="line">[Huawei]ssh server-source all-interface</span><br><span class="line">[Huawei]acl 2001</span><br><span class="line">[Huawei-acl-basic-2001]rule 5 permit source 1.1.1.1 0.0.0.255</span><br><span class="line">[Huawei]aaa</span><br><span class="line">[Huawei-aaa]local-aaa-user password policy administrator</span><br><span class="line">[Huawei-aaa]undo password alert original  //取消第一次登录修改密码</span><br><span class="line">[Huawei-aaa]password expire 90            //密码过期90天</span><br><span class="line">[Huawei-aaa]local-aaa-user wrong-password retry-interval 5 retry-time 5 block-time 10   //密码尝试登录失败5次，锁用户10分钟</span><br><span class="line">[Huawei-aaa]user-password complexity-check three-of-kinds    //设置密码为四选三复杂度检查功能</span><br><span class="line">[Huawei-aaa]local-user glxyxxk  password irreversible-cipher Glxy@2024 privilege level 15</span><br><span class="line">[Huawei-aaa]ocal-user user  password irreversible-cipher Glxy@2024 privilege level 1</span><br><span class="line">[Huawei-aaa]local-user user service-type ssh</span><br><span class="line">[Huawei]user-interface vty 0 4</span><br><span class="line">[Huawei-ui-vty0-4]authentication-mode aaa</span><br><span class="line">[[Huawei-ui-vty0-4]acl 2001 inbound</span><br><span class="line">[Huawei-ui-vty0-4]protocol inbound ssh</span><br><span class="line">[Huawei-ui-vty0-4]idle-time 10 //10分钟不操作自动退出</span><br><span class="line">[Huawei]display local-aaa-user password policy administrator //检查配置</span><br><span class="line">[Huawei-aaa]display this     //检查配置</span><br></pre></td></tr></table></figure>

<h1 id="华三交换机配置"><a href="#华三交换机配置" class="headerlink" title="华三交换机配置"></a>华三交换机配置</h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">针对设备的用户做密码策略，也可以对某一个用户做策略</span><br><span class="line">[H3c]password-control enable</span><br><span class="line">[H3c]password-control aging 90</span><br><span class="line">[H3c]password-control change-password first-login enabless</span><br><span class="line">[H3c]password-control length 8</span><br><span class="line">[H3c]password-control login idle-time 30  //30天未登录设备，锁定账号</span><br><span class="line">[H3c]password-control complexity same-character check  //开启在配置的密码中检查包含连续三个或以上相同字符的功能</span><br><span class="line">[H3c]ssh server enable</span><br><span class="line">[H3c]local-user admin</span><br><span class="line">[H3c-luser-admin]password simple admin12345</span><br><span class="line">[H3c-luser-admin]server type ssh</span><br><span class="line">[H3c]line vty 0 4</span><br><span class="line">[H3c]authentication-mode scheme</span><br><span class="line">[H3c]protocol inbound ssh</span><br><span class="line">[H3c-line-vty0-4]user-role network-admin</span><br><span class="line">[H3c-line-vty0-4]user-role network-operator</span><br><span class="line">[H3c-line-vty0-4]idle-timeout 10 0     //10分钟不操作自动退出</span><br><span class="line">[H3c]display password-control  //检查配置</span><br><span class="line">[H3c]acl 2001</span><br><span class="line">[H3c]rule 5 permit source 1.1.1.1 0.0.0.255</span><br><span class="line">[H3c]ssh server acl 2001</span><br></pre></td></tr></table></figure>

]]></content>
  </entry>
  <entry>
    <title>虚拟化集群和存储双活</title>
    <url>/2024/09/05/20240905-20240905/</url>
    <content><![CDATA[<h1 id="虚拟化集群和存储双活："><a href="#虚拟化集群和存储双活：" class="headerlink" title="虚拟化集群和存储双活："></a>虚拟化集群和存储双活：</h1><hr>
<p>传统集中式存储采用控制器+硬盘柜的方式，通过冗余的双控制器提供数据管理和读写能力（也有超过2个控制器的多控存储，多见于高端存储），通过控制器自带的硬盘槽位或扩展硬盘柜提供存储空间。<br>集中式存储的硬盘数据保护多采用RAID技术，比如RAID5、RAID6、RAID10、RAID-TP等。<br>分布式存储为了实现更灵活的扩展性和更大的存储规模，采用无中心的组网方式，每个存储节点都可以同时提供计算和存储资源。它们通过内部交换机互联起来，基于分布式存储软件提供统一的存储资源池。比如1个节点是200TB容量，那么5个节点就是1000TB容量，并可以扩展到数千个节点EB级别的容量，所以更适合用在海量数据的场景下。<br>与集中式存储不同的是，分布式存储的硬盘数据保护多采用多副本和纠删码技术。</p>
<p>设备：两台华为集中式存储，四台光纤存储交换机，两台业务交换机，十台服务器。<br>每台存储有19块3.84TB的硬盘做raid6，实际可使用空间50.698TB。<br>光纤存储交换机端口和模块是16GB的，FC组网，10台服务器做VMware vSphere集群，仲裁服务器用集群里面的虚拟机做。</p>
<p>拓扑图：</p>
<p><img src="/./images/20240905/download.png" alt="download"><br><img src="/./images/20240905/image-20240905094456773.png" alt="image-20240905094456773"></p>
<h2 id="整体连线："><a href="#整体连线：" class="headerlink" title="整体连线："></a>整体连线：</h2><hr>
<p>每台服务器有两张HBA卡，两张以太网卡，还有4个管理网口，1个BMC口，将每台服务器的一个管理网口和两台存储的管理网口通过网线连接到管理交换机，将站点1的5台服务器的每张以太网卡选一个业务口做动态链路聚合连接到站点1的业务交换机，每张HBA卡选一个HBA口连接到站点1的光交换机。站点1的存储的两个控制器分别连4条线到2个光纤存储交换机，站点2同样配置。</p>
<table>
<thead>
<tr>
<th>设备名称</th>
<th>设备连线图(数字标号相同的端口，表示相互链接)</th>
<th>设备名称</th>
<th>设备连线图(数字标号相同的端口，表示相互链接)</th>
</tr>
</thead>
<tbody><tr>
<td>redhat01</td>
<td><img src="/./images/20240905/image-20240905164131522.png" alt="image-20240905164131522"></td>
<td>redhat03</td>
<td><img src="/./images/20240905/clip_image007.png" alt="img"></td>
</tr>
<tr>
<td>redhat02</td>
<td><img src="/./images/20240905/clip_image004.png" alt="img"></td>
<td></td>
<td></td>
</tr>
<tr>
<td>ESXI01</td>
<td><img src="/./images/20240905/image-20240918091022669.png" alt="image-20240918091022669"></td>
<td>ESXI06</td>
<td><img src="/./images/20240905/clip_image008.png" alt="img"></td>
</tr>
<tr>
<td>ESXI02</td>
<td><img src="/./images/20240905/image-20240918091035978.png" alt="image-20240918091035978"></td>
<td>ESXI07</td>
<td><img src="/./images/20240905/clip_image012.png" alt="img"></td>
</tr>
<tr>
<td>ESXI03</td>
<td><img src="/./images/20240905/clip_image018.png" alt="img"></td>
<td>ESXI08</td>
<td><img src="/./images/20240905/clip_image016.png" alt="img"></td>
</tr>
<tr>
<td>ESXI04</td>
<td><img src="/./images/20240905/clip_image022.png" alt="img"></td>
<td>ESXI09</td>
<td><img src="/./images/20240905/clip_image020.png" alt="img"></td>
</tr>
<tr>
<td>ESXI05</td>
<td><img src="/./images/20240905/image-20240905164211682.png" alt="image-20240905164211682"></td>
<td>ESXI010</td>
<td><img src="/./images/20240905/clip_image024.png" alt="img"></td>
</tr>
<tr>
<td>管理交换机</td>
<td><img src="/./images/20240905/clip_image031.png" alt="img"></td>
<td>管理交换机</td>
<td><img src="/./images/20240905/image-20240905164741978.png" alt="image-20240905164741978"></td>
</tr>
<tr>
<td>Switch001</td>
<td><img src="/./images/20240905/clip_image035.png" alt="img"></td>
<td>Switch003</td>
<td><img src="/./images/20240905/image-20240905164730220.png" alt="image-20240905164730220"></td>
</tr>
<tr>
<td>Switch002</td>
<td><img src="/./images/20240905/clip_image039.png" alt="img"></td>
<td>Switch004</td>
<td><img src="/./images/20240905/image-20240905164814227.png" alt="image-20240905164814227"></td>
</tr>
<tr>
<td>Storage001</td>
<td><img src="/./images/20240905/clip_image041.png" alt="img"></td>
<td>Storage002</td>
<td><img src="/./images/20240905/clip_image037.png" alt="img"></td>
</tr>
</tbody></table>
<h2 id="服务器做集群："><a href="#服务器做集群：" class="headerlink" title="服务器做集群："></a>服务器做集群：</h2><hr>
<ol>
<li>10台服务器都有1块512G硬盘用来安装VMware ESXi，安装好后配置IP地址，选其中一台服务器通过web登录进去上传Windows Server镜像安装DNS服务器，安装好后添加A记录xxx.com –&gt; x.x.x.x(vCenter的ip)，VCenter的ip和域名xxx.com绑定，通过 FQDN 这种方式部部署 VCSA（vCenter server appliance）。</li>
<li>电脑和服务器连接同一网络，电脑上下载VMware-VCSA-all-8.0.1-21560480.iso镜像，通过installer.exe开始安装VMware vCenter Server。<br><img src="/./images/20240905/1.jpg" alt="1"></li>
<li>安装好后登录VMware vCenter添加数据中心和ESXi主机组件集群，打开”DRS和vSphere HA“高级功能。</li>
</ol>
<h2 id="网络设置："><a href="#网络设置：" class="headerlink" title="网络设置："></a>网络设置：</h2><hr>
<h3 id="新建集群交换机："><a href="#新建集群交换机：" class="headerlink" title="新建集群交换机："></a>新建集群交换机：</h3><p>添加集群交换机和网络：添加主机后，右键选中主机添加网络，标准交换机，将服务器连接管理交换机的网口添加到交换机里，vlan id不填，同样的方式将10台主机加入到虚拟交换机里。<img src="/./images/20240905/image-20240905152142014.png" alt="image-20240905152142014"><img src="/./images/20240905/1725520576423.png" alt="1725520576423"><img src="/./images/20240905/1725520653585.png" alt="1725520653585"></p>
<h3 id="新建分布式-业务-交换机："><a href="#新建分布式-业务-交换机：" class="headerlink" title="新建分布式(业务)交换机："></a>新建分布式(业务)交换机：</h3><p>新建分布式交换机，新建之后在配置选项卡，选择LACP，新建链路聚合组<br><img src="/./images/20240905/1725521560095.png" alt="1725521560095"><br><img src="/./images/20240905/1725523634658.png" alt="1725523634658"></p>
<h3 id="新建分布式端口组："><a href="#新建分布式端口组：" class="headerlink" title="新建分布式端口组："></a>新建分布式端口组：</h3><p>右键刚添加的分布式交换机，新建分布式端口组，选择VLAN中继，选择自定义策略配置，上行链路端口将 Distributed Switch 连接到关联主机上的物理网卡，上行链路端口选择两个业务口做动态链路聚合连接业务交换机，将lag1移到活动上行链路，将其他链路移到未使用的上行链路。<br><img src="/./images/20240905/1725521824913.png" alt="1725521824913"><img src="/./images/20240905/1725522226960.png" alt="1725522226960"><img src="/./images/20240905/1725522393668.png" alt="1725522393668"></p>
<h3 id="添加和管理主机："><a href="#添加和管理主机：" class="headerlink" title="添加和管理主机："></a>添加和管理主机：</h3><p><img src="/./images/20240905/1725523347366.png" alt="1725523347366"></p>
<h2 id="存储配置："><a href="#存储配置：" class="headerlink" title="存储配置："></a>存储配置：</h2><hr>
<p>创建存储池，19块3.84T硬盘做RAID6，1热备盘，2校验盘。<br>创建LUN、创建LUN组。<br>创建主机、创建主机组、做映射。<br>创建远端设备，创建双活域。</p>
<h1 id="数据库双机热备："><a href="#数据库双机热备：" class="headerlink" title="数据库双机热备："></a>数据库双机热备：</h1><p>数据库主备模式部署，配置多路径软件，通过安装和配置ROSA HA软件，实现自动切换挂载。可以保证在一个数据库实例发生故障时，另一个实例可以立即接管并提供服务，从而实现高可用性和容灾保护。</p>
]]></content>
  </entry>
  <entry>
    <title>终端接入认证</title>
    <url>/2024/09/18/20240918-20240918/</url>
    <content><![CDATA[<h1 id="802-1X-AD域用户认证"><a href="#802-1X-AD域用户认证" class="headerlink" title="802.1X+AD域用户认证"></a>802.1X+AD域用户认证</h1><hr>
<p>设备：深信服全网行为管理AC</p>
<h2 id="全网AC配置"><a href="#全网AC配置" class="headerlink" title="全网AC配置"></a>全网AC配置</h2><hr>
<p><strong>配置核心要点</strong>：</p>
<ol>
<li>需要使用全网AC，支持802.1x对接</li>
<li>在AC接入管理-接入认证-802.1x认证里开启802.1x功能并配置radius密钥(界面勾选账号密码认证)</li>
<li>创建本地用户（或者关联LDAP）并添加用户绑定关系</li>
<li>使用802.1x工具生成交换机配置并刷入交换机</li>
<li>交换机配置SNMP，AC开启跨三层取MAC进行对接</li>
<li>绑定用户和MAC实现哑终端mac免认证</li>
<li>使用测试电脑接入验证</li>
</ol>
<p><img src="/./images/20240918/1726708823572.png" alt="1726708823572"></p>
<p><img src="/./images/20240918/image-20240919093517940.png" alt="image-20240919093517940"><br><img src="/./images/20240918/image-20240919093641873.png" alt="image-20240919093641873"><img src="/./images/20240918/image-20240919094047439.png" alt="image-20240919094047439"></p>
<p><img src="/./images/20240918/1726709888642.png" alt="1726709888642"></p>
<p>全网行为管理AC同一个用户最多可以绑定100条用户绑定信息<br><img src="/./images/20240918/1726711666898.jpg" alt="1726711666898"></p>
<h2 id="交换机配置"><a href="#交换机配置" class="headerlink" title="交换机配置"></a>交换机配置</h2><hr>
<p>交换机型号华为S5735S</p>
<p>配置思路：<br>1.创建aaa方案并配置认证方式和计费方式为radius<br>2.创建并配置radius服务器模板的各项参数<br>3.创建认证域并在其上绑定aaa认证方案和计费方案与radius服务器模板<br>4.配置全局默认域<br>5.配置接口开启802.1X认证</p>
<p>step1：创建并配置RADIUS服务器模板“sangfor_rd”。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;HUAWEI&gt;system-view                                //进入系统视图</span><br><span class="line">[HUAWEI] radius-server template sangfor_rd         //创建radius服务器模板“sangfor_rd”</span><br><span class="line">[HUAWEI-radius-sangfor_rd] radius-server authentication 192.168.254.100 1812 //设置radius服务器的认证IP地址和端口号</span><br><span class="line">[HUAWEI-radius-sangfor_rd] radius-server accounting 192.168.254.100 1813     //设置radius服务器的计费IP地址和端口号</span><br><span class="line">[HUAWEI-radius-sangfor_rd] radius-server shared-key cipher 123456     //设置接入设备与radius认证服务器的共享密钥</span><br><span class="line">[HUAWEI-radius-sangfor_rd] quit</span><br></pre></td></tr></table></figure>

<p>step2：创建AAA认证方案“sangfor_aaa”并配置认证方式为RADIUS。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[HUAWEI] aaa</span><br><span class="line">[HUAWEI-aaa] authentication-scheme sangfor_aaa	            //创建aaa认证方案&quot;sangfor_aaa&quot;</span><br><span class="line">[HUAWEI-aaa-authen-sangfor_aaa] authentication-mode radius	//配置当前认证方案使用的认证模式</span><br><span class="line">[HUAWEI-aaa-authen-sangfor_aaa] quit</span><br><span class="line">[HUAWEI-aaa]accounting-scheme sangfor_aaa		            //创建aaa计费方案&quot;sangfor_aaa&quot;</span><br><span class="line">[HUAWEI-aaa-accounting-sangfor_aaa]accounting-mode radius	//配置当前使用的计费模式“radius”</span><br><span class="line">[HUAWEI-aaa-accounting-sangfor_aaa]quit</span><br></pre></td></tr></table></figure>

<p>step3：创建认证域“sangforAD”，并在其上绑定AAA认证方案“sangfor_aaa”与RADIUS服务器模板“sangfor_rd”。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[HUAWEI-aaa] domain sangforAD								      //创建认证域“sangforAD”</span><br><span class="line">[HUAWEI-aaa-domain-sangforAD] authentication-scheme sangfor_aaa	  //在域下绑定aaa认证方案“sangfor_aaa”</span><br><span class="line">[HUAWEI-aaa-domain-sangforAD] accounting-scheme sangfor_aaa		  //在域下绑定aaa计费方案“sangfor_aaa”</span><br><span class="line">[HUAWEI-aaa-domain-sangforAD] radius-server sangfor_rd			  //在认证域下绑定radius服务器模板“sangfor_rd”</span><br><span class="line">[HUAWEI-aaa-domain-sangforAD] quit</span><br><span class="line">[HUAWEI-aaa] quit</span><br></pre></td></tr></table></figure>

<p>指定全局默认域, 全局默认域只能配置一个多次配置会被覆盖</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[HUAWEI]domain sangfor_AD                                 //配置全局默认域为“sangfor_AD”</span><br></pre></td></tr></table></figure>

<p>step4：配置802.1X认证（可选）。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">配置802.1X接入模板“sangfor_ap”，802.1X接入模板默认采用EAP认证方式。请确保RADIUS服务器支持EAP协议，否则无法处理802.1X认证请求。</span><br><span class="line">[HUAWEI] dot1x-access-profile name sangfor_ap</span><br><span class="line">[HUAWEI-dot1x-access-profile-sangfor_ap] dot1x authentication-method eap</span><br><span class="line">[HUAWEI-dot1x-access-profile-sangfor_ap] quit</span><br></pre></td></tr></table></figure>

<p>step5：配置认证模板“sangfor_apf”，并在其上绑定802.1X接入模板“sangfor_ap”、指定认证模板下用户的强制认证域为“sangforAD”。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[HUAWEI] authentication-profile name sangfor_apf</span><br><span class="line">[HUAWEI-authen-profile-sangfor_apf] dot1x-access-profile sangfor_ap</span><br><span class="line">[HUAWEI-authen-profile-sangfor_apf] access-domain sangforAD force       配置端口802.1x强制使用的认证域，如果不配则使用全局默认域</span><br><span class="line">[HUAWEI-authen-profile-sangfor_apf] quit</span><br></pre></td></tr></table></figure>

<p>step6：配置MAC认证<br>配置MAC接入模板，MAC认证用户的用户名和密码默认均为不带分隔符“-”的MAC地址。需要保证RADIUS服务器上配置的MAC用户名和密码格式与接入设备上的保持一致。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[HUAWEI] mac-access-profile name m1     //创建mac 认证模板</span><br><span class="line">[HUAWEI-mac-access-profile-m1] mac-authen username macaddress format with-hyphen	//设置用户名为xx-xx-xx-xx-xx-xx 的mac地址形式</span><br><span class="line">[HUAWEI-mac-access-profile-m1] quit</span><br><span class="line">[HUAWEI]dot1x timer mac-bypass-delay 30    //配置接入设备802.1x无响应多久后做mab认证</span><br><span class="line">[HUAWEI] authentication-profile name sangfor_apf</span><br><span class="line">[HUAWEI-authen-profile-sangfor_apf] mac-access-profile m1</span><br><span class="line">[HUAWEI-authen-profile-sangfor_apf] authentication dot1x-mac-bypass   //启用MAC旁路认证</span><br><span class="line">[HUAWEI-authen-profile-sangfor_apf] quit</span><br></pre></td></tr></table></figure>

<p>step7：在接口GE0&#x2F;0&#x2F;48上绑定认证模板“sangfor_apf”，使能802.1X认证。以接口GE0&#x2F;0&#x2F;48为例，其他接口配置与其类似。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[HUAWEI] interface gigabitethernet 0/0/48</span><br><span class="line">[HUAWEI-GigabitEthernet0/0/48] authentication-profile sangfor_apf</span><br><span class="line">[HUAWEI-GigabitEthernet0/0/48] quit</span><br></pre></td></tr></table></figure>

<p>step8：配置免认证访问ip<br>NAC认证用户在认证成功之前，无法访问网络。通过配置免认证规则（free-rule）可以使特定的用户无需通过Portal认证即可访问网络中的特定资源。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[HUAWEI] free-rule-template name default_free_rule</span><br><span class="line">[HUAWEI-free-rule-default_free_rule] free-rule 1 destination ip 10.11.12.13 mask 255.255.255.255 //域控ip，方便域控下发准入插件</span><br><span class="line">[HUAWEI-free-rule-default_free_rule] free-rule 2 destination ip 11.12.13.14 mask 255.255.255.255</span><br></pre></td></tr></table></figure>

<p>step9：防止AC挂掉，所有终端会断网</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">authentication event authen-server-down action authorize keep no-response  //配置用户在认证服务器Down时保持原有的网络访问权限。</span><br><span class="line">authentication event authen-server-noreply action authorize keep no-response  //配置用户在认证服务器无响应时保持原有的网络访问权限。</span><br></pre></td></tr></table></figure>



<h2 id="域控配置"><a href="#域控配置" class="headerlink" title="域控配置"></a>域控配置</h2><hr>
<p>配置思路：</p>
<ol>
<li>下载MSI安装包</li>
<li>域控上面创建组策略</li>
<li>添加需要下发的安装包并分配权限</li>
<li>域单点登录用户登录后会自动安装.msi软件</li>
</ol>
<p><img src="/./images/20240918/1726710158624.png" alt="1726710158624"><br><img src="/./images/20240918/1726710313482.png" alt="1726710313482"></p>
<p>右键编辑，选择软件安装，将.msi的安装包添加进去，来源要填ip加路径。<br><img src="/./images/20240918/1726710396805.png" alt="1726710396805"><br><img src="/./images/20240918/image-20240919094844075.png" alt="image-20240919094844075"><br>权限：<br>Domain user (所有域成员)<br>Domain admin (域管理员)<br>Authenticated Users (Windows系统中所有使用用户名、密码登录并通过身份验证的账户，不包括来宾账户Guest)</p>
<h1 id="检测杀毒软件安装之后才能上网"><a href="#检测杀毒软件安装之后才能上网" class="headerlink" title="检测杀毒软件安装之后才能上网"></a>检测杀毒软件安装之后才能上网</h1><hr>
<p><img src="/./images/20240918/image-20240919100500107.png" alt="image-20240919100500107"><img src="/./images/20240918/image-20240919100858653.png" alt="image-20240919100858653"><br><img src="/./images/20240918/image-20240919100958984.png" alt="image-20240919100958984"></p>
]]></content>
  </entry>
  <entry>
    <title>RedHat8安装openssl3.3.2和openssh9.9p1</title>
    <url>/2024/10/31/20241031-20241031/</url>
    <content><![CDATA[<h1 id="安装openssl3-3-2"><a href="#安装openssl3-3-2" class="headerlink" title="安装openssl3.3.2"></a>安装openssl3.3.2</h1><p>   ssh -V 查看当前openssl和openssh的版本</p>
<ol>
<li><p>不联网的服务器需要设置本地源安装依赖<br>挂载服务器镜像mount &#x2F;dev&#x2F;sr0 &#x2F;mnt&#x2F;cdrom<br><img src="/./images/20241031/1730340085846.png" alt="1730340012366"><br>创建并修改镜像文件local.repo</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">vi /etc/yum.repos.d/local.repo</span><br><span class="line">[local]</span><br><span class="line">name=local</span><br><span class="line">baseurl=file:///mnt/cdrom/BaseOS</span><br><span class="line">gpgcheck=0</span><br><span class="line">enabled=1</span><br><span class="line">[AppStream]</span><br><span class="line">name=AppStream</span><br><span class="line">baseurl=file:///mnt/cdrom/AppStream</span><br><span class="line">gpgcheck=0</span><br><span class="line">enabled=1</span><br></pre></td></tr></table></figure>

<p>修改完后输入<br>yum clean all  更新镜像<br>yum makecache  生成缓存<br><img src="/./images/20241031/image-20241031100734370.png" alt="image-20241031100734370"></p>
</li>
<li><p>安装依赖</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">yum install -y perl-Pod-Html perl-IPC-Cmd gcc zlib zlib-devel pam-devel pcre pcre-devel</span><br></pre></td></tr></table></figure>
</li>
<li><p>解压并安装openssl</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">tar -xzvf openssl-3.3.2.tar.gz</span><br><span class="line">cd openssl-3.3.2w</span><br><span class="line">mkdir -p /usr/openssh/openssl3.3.2</span><br><span class="line">./config --prefix=/usr/openssh/openssl3.3.2</span><br><span class="line"> make &amp;&amp; make install</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建新版本软链接</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ln -s /usr/local/openssl/bin/openssl /usr/bin/</span><br><span class="line">ln -s /usr/local/openssl/lib64/libssl.so.3 /usr/lib64/</span><br><span class="line">ln -s /usr/local/openssl/lib64/libcrypto.so.3 /usr/lib64/</span><br><span class="line"># ln -s /usr/local/openssl/include/openssl /usr/include/openssl</span><br><span class="line">echo &quot;/usr/local/openssl/lib64&quot; &gt;&gt; /etc/ld.so.conf.d/ssl.conf</span><br><span class="line">ldconfig -v</span><br></pre></td></tr></table></figure>
</li>
<li><p>输入ssh -V 验证安装是否成功<br><img src="/./images/20241031/image-20241031101754080.png" alt="image-20241031101754080"></p>
</li>
</ol>
<h1 id="安装openssh9-9p1"><a href="#安装openssh9-9p1" class="headerlink" title="安装openssh9.9p1"></a>安装openssh9.9p1</h1><ol>
<li><p>卸载旧版本</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#卸载旧版本</span><br><span class="line">service sshd stop</span><br><span class="line">yum remove -y openssh</span><br><span class="line">#清理残余文件</span><br><span class="line">rm -rf /etc/ssh/*</span><br></pre></td></tr></table></figure>
</li>
<li><p>开始安装</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cd  /usr/local</span><br><span class="line">tar -xzvf openssh-9.8p1.tar.gz</span><br><span class="line">chown -R root.root openssh-9.8p1</span><br><span class="line">cd openssh-9.8p1</span><br><span class="line">./configure --prefix=/usr/local/openssh --sysconfdir=/etc/ssh --with-ssl-dir=/usr/local/openssl --without-openssl-header-check --with-pam --with-privsep-path=/var/lib/sshd --with-md5-passwords --with-zlib=/usr/local/src/zlib</span><br><span class="line">make -j 4 &amp;&amp; make install</span><br></pre></td></tr></table></figure>
</li>
<li><p>安装完成</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#查看目录版本 /usr/local/openssh/bin/ssh -V</span><br><span class="line">#复制启动文件到/etc/init.d/下并命名为sshd</span><br><span class="line">cp -p contrib/redhat/sshd.init /etc/init.d/sshd</span><br><span class="line">cp -a contrib/redhat/sshd.pam /etc/pam.d/sshd.pam</span><br><span class="line">cp -rf /usr/local/openssh/sbin/sshd /usr/sbin/sshd</span><br><span class="line">cp -rf /usr/local/openssh/bin/ssh /usr/bin/ssh</span><br><span class="line">cp -rf /usr/local/openssh/bin/ssh-keygen /usr/bin/ssh-keygen</span><br><span class="line"></span><br><span class="line">#允许root登录</span><br><span class="line">echo &#x27;PermitRootLogin yes&#x27; &gt;&gt; /etc/ssh/sshd_config</span><br><span class="line">echo &#x27;PasswordAuthentication yes&#x27; &gt;&gt; /etc/ssh/sshd_config</span><br><span class="line"></span><br><span class="line">#重启sshd服务</span><br><span class="line">/etc/init.d/sshd restart</span><br><span class="line">#查看服务运行状态</span><br><span class="line">/etc/init.d/sshd status</span><br><span class="line">#添加开机启动</span><br><span class="line">chkconfig --add sshd</span><br></pre></td></tr></table></figure>

<p>查看升级后ssh版本 ssh -V<br><img src="/./images/20241031/image-20241031102917423.png" alt="image-20241031102917423"></p>
</li>
</ol>
<p>遇到的问题：升级后可能会连接不上，提示&#x2F;bin&#x2F;bash : Permission denied<br>解决方法：1.可以提前关闭selinux  </p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">执行命令临时关闭</span><br><span class="line">setenforce 0</span><br><span class="line">更改selinux的配置文件永久关闭</span><br><span class="line"># vi /etc/selinux/config</span><br><span class="line">更改SELINUX=enforcing为SELINUX=disabled</span><br></pre></td></tr></table></figure>

<p>2.登录失败后执行命令生成相关selinux策略</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">使用 audit2allow 生成策略：根据找到的拒绝信息，使用 audit2allow 工具生成 SELinux 策略</span><br><span class="line">sudo cat /var/log/audit/audit.log | audit2allow -M mysshd</span><br><span class="line">加载模块</span><br><span class="line">sudo semodule -i mysshd.pp</span><br></pre></td></tr></table></figure>

]]></content>
  </entry>
  <entry>
    <title>RedHat8等保密码策略配置</title>
    <url>/2024/10/28/20241028-20241028/</url>
    <content><![CDATA[<h1 id="更改密码复杂度和有效期"><a href="#更改密码复杂度和有效期" class="headerlink" title="更改密码复杂度和有效期"></a>更改密码复杂度和有效期</h1><p><img src="/./images/20241028/1730101588028.png" alt="1730101588028"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[root@localhost ~]# vim /etc/pam.d/system-auth</span><br><span class="line">将文件中的下面两行：</span><br><span class="line">password    requisite     pam_cracklib.so try_first_pass retry=3 type=</span><br><span class="line">password    sufficient    pam_unix.so sha512 shadow nullok try_first_pass use_authtok</span><br><span class="line">改为：</span><br><span class="line">password    requisite     pam_cracklib.so try_first_pass retry=3 type= minlen=6 ucredit=-1 lcredit=-1 dcredit=-1</span><br><span class="line">password    sufficient    pam_unix.so md5 shadow nullok try_first_pass use_authtok remember=5</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">查看密码有效期</span><br><span class="line">chage -l root</span><br><span class="line">强制用户下次登陆修改密码，并且设置密码最高有效期90，提前30天发警报提示</span><br><span class="line">chage -d 0 -M 90 -W 30 root</span><br></pre></td></tr></table></figure>

<h1 id="配置登录失败策略和登录超时时间"><a href="#配置登录失败策略和登录超时时间" class="headerlink" title="配置登录失败策略和登录超时时间"></a>配置登录失败策略和登录超时时间</h1><p><img src="/./images/20241028/image-20241028174636484.png" alt="image-20241028174636484"></p>
<h2 id="配置登录30分钟不操作自动退出"><a href="#配置登录30分钟不操作自动退出" class="headerlink" title="配置登录30分钟不操作自动退出"></a>配置登录30分钟不操作自动退出</h2><p>修改&#x2F;etc的profile文件</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">vi /etc/profile</span><br><span class="line">在最后面添加一行export TMOUT=1800</span><br><span class="line">保存后执行source /etc/profile</span><br></pre></td></tr></table></figure>

<h2 id="配置登录失败10次，锁3分钟"><a href="#配置登录失败10次，锁3分钟" class="headerlink" title="配置登录失败10次，锁3分钟"></a>配置登录失败10次，锁3分钟</h2><p>修改&#x2F;etc&#x2F;ssh里的sshd.conf文件</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">vi /etc/ssh/sshd.conf</span><br><span class="line">userpam yes</span><br></pre></td></tr></table></figure>

<p>修改&#x2F;etc&#x2F;pam.d里的system-auth和password-auth文件</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">vim /etc/pam.d/system-auth /etc/pam.d/password-auth</span><br><span class="line">在auth        sufficient    pam_unix.so try_first_pass nullok上下添加两行</span><br><span class="line"></span><br><span class="line">  auth        required      pam_faillock.so preauth silent audit even_deny_root deny=10 unlock_time=180</span><br><span class="line">  auth        sufficient    pam_unix.so try_first_pass nullok</span><br><span class="line">  auth        required      pam_deny.so</span><br><span class="line">  auth        [default=die] pam_faillock.so authfail audit even_deny_root deny=10 unlock_time=180</span><br><span class="line"></span><br><span class="line">在account required pam_unix.so下添加</span><br><span class="line"></span><br><span class="line">  account required pam_faillock.so</span><br></pre></td></tr></table></figure>

<p>在&#x2F;etc&#x2F;pam.d添加sshd文件</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">vim /etc/pam.d/sshd</span><br><span class="line">#文件内容如下</span><br><span class="line">#%PAM-1.0</span><br><span class="line">auth	   required	pam_sepermit.so</span><br><span class="line">auth       substack     password-auth</span><br><span class="line">auth       include      postlogin</span><br><span class="line">#Used with polkit to reauthorize users in remote sessions</span><br><span class="line">-auth      optional     pam_reauthorize.so prepare</span><br><span class="line">account    required     pam_nologin.so</span><br><span class="line">account    include      password-auth</span><br><span class="line">password   include      password-auth</span><br><span class="line">#pam_selinux.so close should be the first session rule</span><br><span class="line">session    required     pam_selinux.so close</span><br><span class="line">session    required     pam_loginuid.so</span><br><span class="line">#pam_selinux.so open should only be followed by sessions to be executed in the user context</span><br><span class="line">session    required     pam_selinux.so open env_params</span><br><span class="line">session    required     pam_namespace.so</span><br><span class="line">session    optional     pam_keyinit.so force revoke</span><br><span class="line">session    include      password-auth</span><br><span class="line">session    include      postlogin</span><br><span class="line">#Used with polkit to reauthorize users in remote sessions</span><br><span class="line">-session   optional     pam_reauthorize.so prepare</span><br></pre></td></tr></table></figure>

<p>修改&#x2F;etc&#x2F;pam.d&#x2F;login文件，添加四行配置</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">vi /etc/pam.d/login</span><br><span class="line">auth       substack     password-auth</span><br><span class="line">account    include      password-auth</span><br><span class="line">password   include      password-auth</span><br><span class="line">session    include      password-auth</span><br></pre></td></tr></table></figure>

<h1 id="创建三权分立账号"><a href="#创建三权分立账号" class="headerlink" title="创建三权分立账号"></a>创建三权分立账号</h1><h1 id><a href="#" class="headerlink" title></a><img src="/./images/20241028/image-20241028175718601.png" alt="image-20241028175718601"></h1><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1.新建系统管理员</span><br><span class="line">useradd sysadmin</span><br><span class="line">passwd sysadmin</span><br><span class="line">新建安全管理员</span><br><span class="line">useradd secadmin</span><br><span class="line">passwd secadmin</span><br><span class="line">新建审计管理员</span><br><span class="line">useradd auditadmin</span><br><span class="line">passwd auditadmin</span><br><span class="line">2.修改visudo配置</span><br><span class="line">visudo </span><br><span class="line">#系统管理员</span><br><span class="line">Cmnd_Alias SOFTWARE = /bin/rpm, /usr/bin/up2date, /usr/bin/yum</span><br><span class="line">Cmnd_Alias SERVICES = /sbin/service, /sbin/chkconfig, /usr/bin/systemctl start, /usr/bin/systemctl stop, /usr/bin/systemctl reload, /usr/bin/systemctl restart, /usr/bin/systemctl status, /usr/bin/systemctl enable, /usr/bin/systemctl disable</span><br><span class="line">Cmnd_Alias STORAGE = /sbin/fdisk, /sbin/sfdisk, /sbin/parted, /sbin/partprobe, /bin/mount, /bin/umount</span><br><span class="line">sysadmin ALL=(root) SOFTWARE,SERVICES,STORAGE</span><br><span class="line"></span><br><span class="line">#安全管理员</span><br><span class="line">Cmnd_Alias DELEGATING = /usr/sbin/visudo, /bin/chown, /bin/chmod, /bin/chgrp</span><br><span class="line">Cmnd_Alias PROCESSES = /bin/nice, /bin/kill, /usr/bin/kill, /usr/bin/killall</span><br><span class="line">Cmnd_Alias NETWORKING = /sbin/route, /sbin/ifconfig, /bin/ping, /sbin/dhclient, /usr/bin/net, /sbin/iptables, /usr/bin/rfcomm, /usr/bin/wvdial, /sbin/iwconfig, /sbin/mii-tool</span><br><span class="line">secadmin ALL=(root) DELEGATING,PROCESSES,NETWORKING</span><br><span class="line"> </span><br><span class="line">#审计管理员的权限</span><br><span class="line">auditadmin ALL=(root) NOPASSWD:/usr/sbin/aureport,NOPASSWD:/usr/sbin/autrace,NOPASSWD:/usr/sbin/ausearch,NOPASSWD:/usr/sbin/audispd,NOPASSWD:/usr/sbin/auditctl</span><br><span class="line"> </span><br><span class="line">3.测试配置是否正确</span><br><span class="line">visudo -c</span><br></pre></td></tr></table></figure>

]]></content>
  </entry>
  <entry>
    <title>RedHat8服务器开启谷歌二次验证</title>
    <url>/2024/11/19/20241119-20241119/</url>
    <content><![CDATA[<p>手机上安装谷歌验证器app</p>
<p><strong><a href="https://pan.baidu.com/s/1lsG2jRi3RjxE7iaG0q0qtg?pwd=tyqv">https://pan.baidu.com/s/1lsG2jRi3RjxE7iaG0q0qtg?pwd=tyqv</a></strong> </p>
<p>服务器修改网络源</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cd /etc/yum.repos.d/</span><br><span class="line">wget http://mirrors.aliyun.com/repo/Centos-8.repo</span><br></pre></td></tr></table></figure>

<p>安装环境</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">yum install automake libtool  pam-devel qrencode make git google-authenticator</span><br></pre></td></tr></table></figure>

<p>打开文件 <code>/etc/pam.d/sshd</code> 并在文件头行添加以下行</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">vi /etc/pam.d/sshd </span><br><span class="line"># Add to end auth required pam_google_authenticator.so</span><br></pre></td></tr></table></figure>

<p>然后修改<code>/etc/ssh/sshd_config</code></p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">vi /etc/ssh/sshd_config</span><br><span class="line">ChallengeResponseAuthentication yes</span><br></pre></td></tr></table></figure>

<p>运行google-authenticator<br><img src="/./../../images/20241119/image-20241119165124811.png" alt="image-20241119165124811"></p>
<p>会生成一个二维码并让你输入一串数字，手机打开app扫描二维码</p>
<p>输入获得的数字（这一步需要联网，之后登录就不需要联网了）</p>
<p>这会问你一系列的问题，这里是一个推荐的配置：</p>
<ul>
<li>使用“基于时间”的基于时间的标记：<strong>是</strong></li>
<li>更新 <code>.google_authenticator</code> 文件：<strong>是</strong></li>
<li>禁止多次使用同一身份验证令牌：<strong>是</strong></li>
<li>增加原始生成时间限制：<strong>否</strong></li>
<li>启用速率限制：<strong>是</strong></li>
</ul>
<p>测试登录<br><img src="/./../../images/20241119/1732006317037.png" alt="1732006317037"></p>
<p>也可以使用mircrosoft 验证，安卓的应用商场能搜到</p>
]]></content>
  </entry>
  <entry>
    <title>负载均衡AD常用配置</title>
    <url>/2024/11/11/20241111-20241111/</url>
    <content><![CDATA[<h1 id="负载均衡AD常用配置"><a href="#负载均衡AD常用配置" class="headerlink" title="负载均衡AD常用配置"></a>负载均衡AD常用配置</h1><h2 id="部署配置"><a href="#部署配置" class="headerlink" title="部署配置"></a>部署配置</h2><p>AD路由模式部署，配置接口ip，配置3条默认路由到不同线路，再配置一条到内网的回程路由。<br><img src="/./images/20241111/1731296098201.png" alt="1731296098201"></p>
<h2 id="配置源NAT"><a href="#配置源NAT" class="headerlink" title="配置源NAT"></a>配置源NAT</h2><p><img src="/./images/20241111/image-20241111113639676.png" alt="image-20241111113639676"></p>
<h2 id="配置目的nat"><a href="#配置目的nat" class="headerlink" title="配置目的nat"></a>配置目的nat</h2><p>网络部署-地址转换-目的地址转换，配置双向映射需要再源地址指定链路添加所有LAN口，再配置源NAT<br><img src="/./images/20241111/image-20241111114339043.png" alt="image-20241111114339043"><br>双向映射配置源NAT<br><img src="/./images/20241111/image-20241111114551419.png" alt="image-20241111114551419"></p>
<h2 id="链路负载"><a href="#链路负载" class="headerlink" title="链路负载"></a>链路负载</h2><p>链路负载-智能路由，链路策略选择带宽比例或者加权最小流量<br><img src="/./images/20241111/1731296338531.png" alt="1731296338531"></p>
<h2 id="应用负载"><a href="#应用负载" class="headerlink" title="应用负载"></a>应用负载</h2><p>配置虚拟服务和SSL卸载-单向（配置双向的话需要安装客户端的证书才能进行SSL握手），客户申请了证书，但是不方便在服务器上配置，需要再AD上进行修改，实现映射内网服务器的80端口，外部通过https访问。</p>
<ol>
<li><p>添加业务主机</p>
<p>添加业务主机，填写内网服务器IP，选择ping来检测<img src="/./images/20241111/image-20241111152511246.png" alt="image-20241111152511246"></p>
</li>
<li><p>添加节点池<br>应用负载-节点池，添加节点池，填写内网服务器IP和端口。</p>
<p><img src="/./images/20241111/image-20241111151327175.png" alt="image-20241111151327175"></p>
</li>
<li><p>配置虚拟服务</p>
<p>一般用于灵活配置流量转发、业务高可用、安全防护，如根据业务数据灵活转发流量；<br>如业务流量过大，一台服务器无法承受时对业务进行扩容；如通过健康检查机制保证<br>业务高可用；如隐藏服务器真实IP或网站路径；如防止SYN FLOOD攻击、 HTTP攻击<br>等  </p>
<p>应用负载-虚拟服务，添加虚拟服务IP地址填公网地址，外部使用https访问，端口填443，节点池选择刚才添加的80端口的节点。</p>
<p><img src="/./images/20241111/1731309393336.jpg" alt="1731309393336"><br>开启HTTPS自动跳转，访问http域名的时候自动重定向为访问https<br><img src="/./images/20241111/1731309542404.jpg" alt="1731309542404"></p>
</li>
<li><p>导入SSL证书，一般为.cer、.crt、.p12、.pfx</p>
<p><img src="/./images/20241111/image-20241111115723475.png" alt="image-20241111115723475"></p>
</li>
<li><p>配置SSL策略</p>
<p>应用负载-SSL策略-SSL卸载策略，RSA服务器证书选择刚才导入的SSL证书。</p>
<p><img src="/./images/20241111/image-20241111143742739.png" alt="image-20241111143742739"></p>
</li>
</ol>
]]></content>
  </entry>
  <entry>
    <title>堡垒机常用操作</title>
    <url>/2024/09/04/20240904-1-20240904-1/</url>
    <content><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="Oh, these decrypted content cannot be verified, but you can still have a look.">
  <script id="hbeData" type="hbeData" data-hmacdigest="74871f8a47b33d5ecc38e3f1f0ebd7c72eb66acee930e42461b5c3972720f615">3ade0eb6bedd7c5d1d1e30a72ac79bdf124974e57a9945b2aeae696f7a9a131681f7ee27ca76e99e0224e901ccf41e6a723347d186946904b42cdfb2a0ffab6d29eec452eeb9658abfb0b195c95014470cdbfbb4b403c5a008c3aba8aae259827e13d194cfafa5c58c1c7ab2c584773df1c6c91079c14d4413ef753239270eb5879fe9fea13375ceeb6f74ad9f1490f84ba917e3ab8db7ac92a8e035600e6a4bf1344299fd9cd80d7fd34246050a4f4009781bd8ab4675f0bc931e60f707644759fd16b7da222767fd4894d963b5d4c95d8fcb04570a2d9093da0d7cb3fc92088288bac70b6ce1a8a64b770ac37ba14005370bbf21c584a60f0e34b888aeb9652cee94504128c93c78df6966597889a868af2b101af40877d72002c1144412c7e9f270630357531c42954be934af79b16949dc82965282c00a3647abe4c51cebf624087b8203b0a5c8ac3b13e2d0fdd01c433c89f9d203aa311cc613244279d50d4752bd5235aecb0db6e5cbc7ddc2c40bc59318dce320193a2666b3795dd08d8443dcb7ecb3a28ae568ae094ccc1f1858e41a701dcc83df04111fa00527ed42709979bbd5c0b611f8c0b8008c0fb8b9d5e9456d6f3a3a87c86b9170518787620b1c9469b0596825ba71aedbab9a35b7ca55c7ba53e9f113e2d0c3177e7edb84b104f162bbe681ac980122c6fe25aca3c6dd86258142ca90c4ca184d6b43f46aba81f8553498bf58a90aedff262f6db4a98fef52d6a107f6d6ad6f0ab5716b2f3edad486e404512ce07a5f7a8d830e47f283d87c5c9edc926fdd8e724afe1d8a57a672479b3aea0a547511ca4513262a0813bfe527b8f17c574e5654cf4fb70721af081e8b5af5b6f722f69edeca8289a2ecb69e7dae917c006cc5aa87e1601c3cd61bea52afe42a802ecc07817d537415a917db74a3f20c371ab8d0e5e4e3132bd2d9608d06c0c08d8877d324d68f4c3a4f672fd64039f4ccb25c0f33ca2014218176a776e80a775a0608d190c799a7d215b599f8fdd8b18a23c3fc3a82c0cb028579e7b34226c6601527efa3544f2e455fedabd302c2dfd383f78cfb9e7a596f8c3a2076aa4deaefe1f5cbbcfd7247747af387fad274a4df7a42aafeb4c023ce2d84b872a5c8dba72f31fea9b3e81b5686a92fe758171c180756336a23a44926b463007fb20c2c8b8aaff0d726d51c9ef9f9d32dff52083f7dcf2d24902920115ad2b639f67e4cb8873d66dca42757334579251bbf6616355e5562a6c159a31edd8cac966c4f24caa5dde2b4b0154f14b530db3354c03a829652c65235932074578a4a8a2f6cabcb892e3e6a297e382317063f90c86a615ae1460fed91c3fc6d76a4001fc63cfa17643ee2d7e2ae7bd6844a0fa9201e98bb7ea05068034a841921a49a0b56054e6871393068fea7b95d40a31c186c9ecedbe07b5cfe72f44a643784af8b3ba8934accaf122b4ea333002535893ae8dcd3be242261a0247c176a5b0ce9b932fbb00339190646aae8ea9aaa74b65b4628272107ce08bcbf00fd1a54d1b33af5bb05841765eae748c44b06d2aef1179ffc30875a55ba198856bc84cf9ee2fc70ee9bd235cc625bd9465522b6f38e061b4d5c08930b9e387a1e0977bb673cbb240eaa6c7b0beff50ff0b157a94f86e6f1e079386bbf5707f6dd6253b5688a07052553bfb31c6f5e892283d2f37cea9585160b0ddfaace590c99ec60ff5046b1b4ec5a10124e799c40b16722342d0ca70c08e700155604a43ce5e8e25896497a0cda621b4b6191deeafb0c732ad5809a6ae95e375339e6b4165cdcce81726643cb0aae6aafa1d850a9a3c634d85ba66a2a1d5cfb7460e78ec5c79fc3b50f0dce3c40864c10e6dc8872f541fe066584d05c81ae2192fb367264c340d50682c314584fa86f8ec9f64bd6c530c4ae4b138fa141ca9842a79459dfe9885a8eae0b713160537efbaeaf644b73675e63d38648ad0fb3dee4469eb971b9c123267de83b3663b6e538e20ba61449c7fafca22b7f632159e1d3905fa896bce7701d23fb538ab3f3ff8b0dd1c494a1cbb4db76232d3b0a30a7e757dc13121667ea74fceb2c1295b5a45da9fe9924a61ee83bbde8c6e8dab9dc97e16c80f61b0716ea8de9e3f74473ade2e8ceaf1d5cced2f27a040204ae84a3218cf94e5fea72a12ca26f2c1240914b4e6ac64125b73d08ff9aece8f609a2aae6e7b8a91664c0f9fb93959787c9c8bd0fc9e408fd4f8459b101befe5da0398287a84f5c0a11c1ab7509254586a30805e20d4c565f9e54a7dcda8643a0df3e399e836e565a69db19f654a199246e44ea993ab4a03505827ab5e3215138448ef4b54815c3872b3f67ef3a68e99f7e663c9ed2d53fa23c8b45360a94a8f682cff127d86b57c97e0aceda648d4fd3de84f3332ded0bb2bd8f3161c6cc58b83bc6e2239e7d48642a8886fb155cf199c50ca9cd7db3aa44ac2444e01cd0a64d2f4b111f7d79f0ef22c438d1873d443ce9c88dbd4c6d372608bbc3a1e9dea81e59103fc3d6c694e09267b03296e1b740ab98f0b374538a8bbc1d6929a5bd433515f770838022fd3c264c7a4a13e5ae0db83a44a2996b5c2ef278e1c7f60f8460151a49bde7f0d99dcf020eb14a1292d83ebe7075b0b6fede0e6cf30480a5038772e7048120bf9caa642a6b393ca3ae1592dae5780d7cefd007ccf67ce67407818be6ff83c05ba5c21cb26c5a64a732a127b71244b472079d710b693b8a055278d14476028114523dd0de99a8e1b8e2e65ce45e6820e74a51b4ffa8a778782a36a7e3f0a700c821825466418156158638b71445d843653e3c719c4e25c39e055f48494c81523a33fa93f5f99e20b3b21030b64cbfdf2026bde856f50c7fe0f4cb9994eaab90343f84d584f542e34bb19a8a43c61375c7f7634b616edfadb1a2f9a13767c2a97814b70390c39ec50f599a2bcff2560404ddf09fa53c04f55234c6d43ace9f8b929fd7ce9de0b2e9a268a2b8f0d567675e3d9647b6a3c8231cfb1a04839eacbc2b4208c9bb5c8c70213778a9983d69f37cbc5ee0563450ff36bdc9f1297c9cab6d27d7ca8b53487d6ed3c53bf94d690c84780a5be5b719fc0b9188f986978e07c9c32f4d5c5ea291895d42b3b52b1bcae06d2a6bc17e6d0260e6ac35400ebbeb2e0a6550433b1b5b3f30dbe0b1ae073826d1b1b8f30ee565594fd92fac4ee1439dc5d610f507862a37891c8c5d90ea9aa9cbd13caeb6303ebf4d7ede410ac36926669e0660fbbedf68cbd45f12529a7bd9a84686949526300c24ef3e0248c63568036a1589d1de3def527fe2d84af464795991bb606854ef38b7b42fea4622614a01a528926145fd7aa58b58b1eaa185bc1d0cc00a92a729098a9823f10fb0c55758d4df7613fe01c2a8ff434845729f80a2d78139ce1201f0679cc3522e6c1a1814873f6004832ff35f2e7c72af7910a28544578c048af9efc7d45d36f428475c1e357f3f25dd72628aed7ae25b4fefe468eefe30a39b6a1b873411252c41578da1c89cc65e15fa4d1ae11f4af64b26ecf79846547e56aac81dccc6e45fdff4996be06d11e6bb3852b16343453ac4598149e83cce55ae5a4084ff8575fba89062d6fb0aa9741847b583bf1c44409b7eacc6718af598f76a6cddd82f7a7b8c06d5e89d8b12bdc382135f4480a0622b32fc1dda8e96be43f9ffff4de4ec3e7f51245905ab4c3dccc0f6bdbf06db765d40abe9b616a23951539db90121dc76088f4b766ea8ce7f2039adf7df981343ef6b7d016635bb565fb054d2178fcfa6c00ca769a805abfad620ac2b99f771fd006182ffc1be443ad483099aaf3b683e6b461ec0ea7baafee30337eb7ac659a7a8b1bd5f7a3dc31305a813e91cb75220a8f24fb8a55afc9f3245e860f9af2d795f137fac0421fc9af48dff607c2c4a76c9dbe2a5adb7bb2fff2eff5d0ee27f39c90189e8449c839c1f61f1b8337f2d77c30e302c33e3bf27a783f822f32c97489e5ebb43c2e68d1f51dcf13ee4529ed512496d4cd79d8693cf0acf49aff5108a2ec76b7ba64c4302ac04e0c3d61dd1133372f469b62584e782b6c66c2ffc567d0f0efc9ea14a97be46c6a474cf9b0eaee028b7e363b8ed69bee15f816984d807cb55ac56268c7b561351516ef42f2095c9e96530ca91025ad225c977de619b0d9ee779d0b66ed1a34ff2cdf72fc4758f6cedc45a75cc56076f620329d18c266bfbab2d9e7f219dabfb9c53ac20aef4dd981b853e0ac652a7e24b97052a8bf3b323fa764fadb6e7c27a6fe98d62ec2c706f5af372bb8e9b86d3cd54235854bfb32c754398c4b594667b44a22e5c96933cbdd59d8929d4333b557d5fc50b0aa2824da5b47f9df7c66d8f377aeb16aee78a7ca7fc47b82d78ce31f8f5483b069307345bc969bec08e497344e558fa97ce910920ac75e22ae68db96307bf6bc1decd9361974cf01f15a631d41b450c4f0e99b66516ecc2140eddce9953a994da392b5b9327aea3a5154c39ac3240b005a901704fc3b40a851fee054c19757e4f2fc6ca4adf8c99e59ee34ad563a5cb72d869ae8db9220e06ec00a90d47dda81f3825086df7a98691793d04376fa4d527cf52faea6d56884dbfb9a74492f50a3edb0b320644a7bb3d74</script>
  <div class="hbe hbe-content">
    <div class="hbe hbe-input hbe-input-default">
      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">
      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">
        <span class="hbe hbe-input-label-content hbe-input-label-content-default">Hey, password is required here.</span>
      </label>
    </div>
  </div>
</div>
<script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
      <tags>
        <tag>encryptAsDiary</tag>
      </tags>
  </entry>
  <entry>
    <title>RedHat 8.7设置本地yum源</title>
    <url>/2024/09/02/20240902-2-20240902/</url>
    <content><![CDATA[<h1 id="RedHat-8-7最小功能安装，很多命令无法使用"><a href="#RedHat-8-7最小功能安装，很多命令无法使用" class="headerlink" title="RedHat 8.7最小功能安装，很多命令无法使用"></a>RedHat 8.7最小功能安装，很多命令无法使用</h1><hr>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cd /mnt</span><br><span class="line">mkdir cdrom</span><br><span class="line">mount /dev/cdrom /mnt/cdrom --挂载镜像文件到cdrom</span><br><span class="line">echo &quot;/dev/cdrom /mnt/cdrom iso9660 defaults,nofail 0 0&quot; --可以设置开机自动挂载</span><br><span class="line">rm -rf /etc/yum.repos.d/* --删除原来的源地址文件也可以备份一份出来放到其他文件夹</span><br><span class="line">touch /etc/yum.repos.d/local.repo --新建repo文件</span><br><span class="line">vi /etc/yum.repos.d/local.repo</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[local]</span><br><span class="line">name=local</span><br><span class="line">baseurl=file:///mnt/cdrom/BaseOS</span><br><span class="line">gpgcheck=0</span><br><span class="line">enabled=1</span><br><span class="line">[AppStream]</span><br><span class="line">name=AppStream</span><br><span class="line">baseurl=file:///mnt/cdrom/AppStream</span><br><span class="line">gpgcheck=0</span><br><span class="line">enabled=1</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">yum clean all</span><br><span class="line">yum makecache</span><br><span class="line">yum list</span><br></pre></td></tr></table></figure>

<p>在RHEL8中把软件源分成了两部分一个是BaseOS,一个是AppStream，<br>所以相对于RHEL7要多配置一个软件源，否则安装软件会报错。</p>
<h1 id="在网站上下载软件包然后上传到服务器手动安装"><a href="#在网站上下载软件包然后上传到服务器手动安装" class="headerlink" title="在网站上下载软件包然后上传到服务器手动安装"></a>在网站上下载软件包然后上传到服务器手动安装</h1><hr>
<p>也可以在网站上下载软件包然后上传到服务器手动安装<br><a href="https://rpmfind.net/linux/rpm2html/search.php?query=glibc-langpack-zh&submit=Search+...&system=&arch=">https://rpmfind.net/linux/rpm2html/search.php?query=glibc-langpack-zh&amp;submit=Search+...&amp;system=&amp;arch=</a><br><a href="https://developer.aliyun.com/mirror/?spm=a2c6h.13651102.0.0.29531b11ryI3IN&serviceType=mirror">https://developer.aliyun.com/mirror/?spm=a2c6h.13651102.0.0.29531b11ryI3IN&amp;serviceType=mirror</a><br>下载对应的软件包然后上传到服务器 运行rpm -ivh xxx.rpm（软件包名字）</p>
]]></content>
  </entry>
  <entry>
    <title>交换机和服务器上抓报</title>
    <url>/2024/09/02/20240902-3-20240902/</url>
    <content><![CDATA[<h1 id="华为交换机上抓报"><a href="#华为交换机上抓报" class="headerlink" title="华为交换机上抓报"></a>华为交换机上抓报</h1><hr>
<p>华为交换机上能抓业务报文，华三的应该不行。<br><img src="/./images/20240902/1725264901397.png" alt="1725264901397"><img src="/./images/20240902/1725265230648.png" alt="1725265230648"><img src="/./images/20240902/1725265007019.png" alt="1725265007019"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[switch]diagnose</span><br><span class="line">[switch-dianose]capture-packet acl 3000 interface eth-trunk destination terminal file test.cap packet-num 100 packet-info </span><br></pre></td></tr></table></figure>



<h1 id="华三交换机上抓报"><a href="#华三交换机上抓报" class="headerlink" title="华三交换机上抓报"></a>华三交换机上抓报</h1><hr>
<p>由于特性包报文捕获只能捕获通过CPU进行软件转发的报文，如需捕获通过硬件转发的报文，则需要配置流镜像功能，将符合条件的硬件转发报文镜像到CPU，以便进行捕获。</p>
<h1 id="服务器上抓报"><a href="#服务器上抓报" class="headerlink" title="服务器上抓报"></a>服务器上抓报</h1><hr>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">tcpdump -i eth0 port 1521 host 192.168.1.1 or src net 172.16.0.0/12 -nnev -c 200 -s0 -w /data/test.cap</span><br></pre></td></tr></table></figure>

<p>使用tcpdump进行抓报</p>
<p><code>-i</code> : 选择要捕获的接口，通常是以太网卡或无线网卡，也可以是 vlan 或其他特殊接口。如果该系统上只有一个网络接口，则无需指定。<br><code>-nn </code>: 单个 n 表示不解析域名，直接显示 IP；两个 n 表示不解析域名和端口。这样不仅方便查看 IP 和端口号，而且在抓取大量数据时非常高效，因为域名解析会降低抓取速度。<br><code>-s0</code>: tcpdump 默认只会截取前 96 字节的内容，要想截取所有的报文内容，可以使用 -s number， number 就是你要截取的报文字节数，如果是 0 的话，表示截取报文全部内容。<br><code>-v</code>: 使用 -v，-vv 和 -vvv 来显示更多的详细信息，通常会显示更多与特定协议相关的信息。<br><code>-e</code>: 显示数据链路层信息。默认情况下 tcpdump 不会显示数据链路层信息，使用 -e 选项可以显示源和目的 MAC 地址，以及 VLAN tag 信息。<br><code>-c</code>: 捕获 count 个包 tcpdump 就退出<br> <code>-w</code>: 参数后接一个以 <code>.pcap</code> 后缀命令的文件名，就可以将 tcpdump 抓到的数据保存到文件中。使用 wireshark 打开此文件便可进行分析<br><code>and</code>: 所有的条件都需要满足，也可以表示为 <code>&amp;&amp;</code><br><code>or</code>: 只要有一个条件满足就可以，也可以表示为 <code>||</code><br><code>not</code>: 取反，也可以使用 <code>!</code><br><code>net</code>: Network 过滤器用来过滤某个网段的数据</p>
<h1 id="使用-Burpsuite-对-APP-进行抓包"><a href="#使用-Burpsuite-对-APP-进行抓包" class="headerlink" title="使用 Burpsuite 对 APP 进行抓包"></a>使用 Burpsuite 对 APP 进行抓包</h1><hr>
<p>原理：使用电脑的burp suite作为手机的代理去访问网站，然后burp suite拦截其中的数据报。<br>电脑和手机连接同一wifi，电脑ip:192.168.101.37。</p>
<p>电脑设置：在 Burpsuite 里面 <code>Proxy — Options — Proxy Listeners — Add</code> 然后在<code>Speciffic address</code>选择<code>192.168.101.37</code>那个 IP 地址（即本机局域网 IP 地址）<img src="/./images/20240902/2.jpg" alt="2"></p>
<p>手机设置：<br>在手机里面网络设置也要设置 <code>手动代理模式</code> ，输入的 <code>IP和端口</code> 都要与 Burpsuite 一样<img src="/./images/20240902/8.jpg" alt="8"><img src="/./images/20240902/7.jpg" alt="7"></p>
<p><img src="/./images/20240902/5.jpg" alt="5"></p>
<p>然后在手机浏览器访问 <code>https://burp</code> 这个地址，去进行下载并安装 burp 证书，因为抓取 HTTPS 流量是需要证书的，点击 <code>CA Certificate</code> 即可进行下载<img src="/./images/20240902/6.jpg" alt="6"></p>
<p>下载之后要对证书文件后缀名进行更改，因为手机是无法打开 <code>.der</code> 后缀的文件，所以要吧 <code>.der</code> 改为 <code>.cer</code> ，然后再进行安装证书</p>
<p><img src="/./images/20240902/3.jpg" alt="3"></p>
<p><img src="/./images/20240902/9.jpg" alt="9"></p>
<p>那么安装之后就可以进行抓取 APP 数据包了<br><img src="/./images/20240902/image-20240903102245838.png" alt="image-20240903102245838"></p>
]]></content>
  </entry>
  <entry>
    <title>不常见问题</title>
    <url>/2024/09/02/20240902-1-20240902/</url>
    <content><![CDATA[<h1 id="CentOS-7-telnet目标服务器秒断开"><a href="#CentOS-7-telnet目标服务器秒断开" class="headerlink" title="CentOS 7 telnet目标服务器秒断开"></a>CentOS 7 telnet目标服务器秒断开</h1><hr>
<p><img src="/./images/20240902/111.png" alt="111"><br>现象：telnet后立刻被拒绝Connetion closed by foreign host<br>网闸映射端口内网地址x.x.x.x 1521 — 192.168.22.122 2182 反馈端口秒断开不通，数据库端口测试不通。</p>
<p>原因：经测试端口是通的，操作错误。</p>
<h1 id="CentOS-7-ping丢包"><a href="#CentOS-7-ping丢包" class="headerlink" title="CentOS 7 ping丢包"></a>CentOS 7 ping丢包</h1><hr>
<p>现象：执行ping命令时提示ping: sendmsg: Operation not permitted<br>64 bytes from 10.1.1.1: icmp_seq&#x3D;34 ttl&#x3D;255 time&#x3D;0.928 ms<br>64 bytes from 10.1.1.1: icmp_seq&#x3D;35 ttl&#x3D;255 time&#x3D;1.01 ms<br>ping: sendmsg: Operation not permitted<br>ping: sendmsg: Operation not permitted<br>显示只丢部分报文</p>
<p>原因：防火墙没关</p>
<h1 id="华为esight接口做链路聚合后不通"><a href="#华为esight接口做链路聚合后不通" class="headerlink" title="华为esight接口做链路聚合后不通"></a>华为esight接口做链路聚合后不通</h1><hr>
<p>现象：对端交换机上配置了动态链路聚合，显示聚合端口down，esight ping网关不通。</p>
<p>原因：esight上需要修改聚合口的模式为802.3ad<br><img src="/./images/20240902/1725244127200.png" alt="1725244127200"></p>
<h1 id="华为esight用户限制IP登录不成功"><a href="#华为esight用户限制IP登录不成功" class="headerlink" title="华为esight用户限制IP登录不成功"></a>华为esight用户限制IP登录不成功</h1><p>现象：创建一个新用户admin123，创建登录IP地址策略，选择IPV4网段添加IP：192.168.1.1&#x2F;32，在192.168.1.1电脑上登录esight显示该IP被禁止登录。</p>
<p>原因：需要添加IPV4区间，192.168.1.0-192.168.1.2(允许192.168.1.1)，192.168.1.3-192.168.1.4(允许192.168.1.3和192.168.1.4)<img src="/./../images/20240902/1730342895713.png" alt="1730342895713"></p>
<h1 id="两台浪潮交换机做MLAG，其中一个上联口显示DOWN"><a href="#两台浪潮交换机做MLAG，其中一个上联口显示DOWN" class="headerlink" title="两台浪潮交换机做MLAG，其中一个上联口显示DOWN"></a>两台浪潮交换机做MLAG，其中一个上联口显示DOWN</h1><hr>
<p>现象：检查交换机的上联口光纤和光模块正常，其中一个接口DOWN。</p>
<p>原因：两台交换机上联口配置不一致导致接口自动shutdown，配置更改一致后需要手动开启no shutdown。<img src="/./images/20240902/3605eb4eb3c4528a0b8bf36715cc2a9.png" alt="3605eb4eb3c4528a0b8bf36715cc2a9"></p>
<p><img src="/./images/20240902/c0ec97a24bea2a7cc5949bee8277ab3.png" alt="c0ec97a24bea2a7cc5949bee8277ab3"><img src="/./images/20240902/f72141ebd7dac73516305722db90693.png" alt="f72141ebd7dac73516305722db90693"></p>
<h1 id="华为设备配置单臂路由时网络不通"><a href="#华为设备配置单臂路由时网络不通" class="headerlink" title="华为设备配置单臂路由时网络不通"></a>华为设备配置单臂路由时网络不通</h1><hr>
<p>现象：华为的设备配置子接口，配置ip后网络不通<br>原因：当IP报文需要从终结子接口发出，但是没有相应的ARP表项时，如果终结子接口上没有配置ARP广播功能，那么系统会直接把该IP报文丢弃。只有通过在子接口上执行命令arp broadcast enable使能终结子接口的ARP广播功能，系统才会构造带Tag的ARP广播报文，然后再从该终结子接口发出</p>
<p>如果终结子接口上没有配置arp broadcast enable命令，那么系统会直接把该IP报文丢弃。此时该终结子接口的路由可以看作是黑洞路由。<br>如果终结子接口上配置了arp broadcast enable命令，那么系统会构造带Tag的ARP广播报文，然后再从该终结子接口发出。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">interface GigabitEthernet0/0/0.20</span><br><span class="line"> dot1q termination vid 20</span><br><span class="line"> ip address 192.168.20.1 255.255.255.0 </span><br><span class="line"> arp broadcast enable </span><br></pre></td></tr></table></figure>

<p>华三设备不需要配置arp broadcast enable</p>
<h1 id="安全设备的业务网段需要和其他管理网段通信"><a href="#安全设备的业务网段需要和其他管理网段通信" class="headerlink" title="安全设备的业务网段需要和其他管理网段通信"></a>安全设备的业务网段需要和其他管理网段通信</h1><p>安全设备1 业务口(ETH1)IP：192.168.254.1 管理口(ETH0)IP：192.168.253.1<br>配置了默认路由0.0.0.0&#x2F;0 192.168.254.254<br>安全设备2 管理口和业务口同一IP：192.168.253.2<br>192.168.254.0&#x2F;24和192.168.253.0&#x2F;24的网关在同一台交换机上<br>现象：发现安全设备1的192.168.254.1不通192.168.253.2<br>原因：安全设备存在直连路由，192.168.253.0&#x2F;24的路由走管理口eth0到网关192.168.253.254，会导致来回路径不一致的问题。需要安全设备1上配置明细路由，ip route-static 192.168.253.2&#x2F;32 192.168.254.254。</p>
]]></content>
  </entry>
</search>
